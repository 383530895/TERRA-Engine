{ MiniMOD 1.00 - Copyright (C) 2004, Benjamin Rosseaux }
PROGRAM MiniModApp;
{$APPTYPE GUI}
{$OPTIMIZATION ON}
{$RANGECHECKS OFF}
{$OVERFLOWCHECKS OFF}

USES Windows,Messages,CommDlg,MiniMod;

VAR WCLASS:TWNDCLASS;
    HFONT,HFONT2,HINST,HANDLE:HWND;
    HEDIT,HLABEL:ARRAY[1..10] OF HWND;
    MSG:TMSG;
    MiniMODClass:TMiniMOD;
    IsDone:LONGBOOL;

FUNCTION WINDOWPROC(HWND1,MSG,WPARAM,LPARAM:LONGINT):LONGINT; STDCALL;
VAR OpenDialog:TOpenFileName;
    S0,S1,S3:STRING;
    S2:ARRAY[0..256] OF CHAR;
BEGIN
 RESULT:=DEFWINDOWPROC(HWND1,MSG,WPARAM,LPARAM);
 CASE MSG OF
  WM_COMMAND:BEGIN
   IF HWND(LPARAM)=HLABEL[1] THEN BEGIN
    S1:='MOD/WOW module files'+#0+'*.mod;*.wow';
    S2:='';
    S3:='Open MOD/WOW module file';
    FILLCHAR(OpenDialog,SIZEOF(OpenDialog),#0);
    OpenDialog.lStructSize:=SIZEOF(OpenDialog);
    OpenDialog.hWndOwner:=HWND1;
    OpenDialog.lpstrFilter:=PCHAR(S1);
    OpenDialog.nFilterIndex:=0;
    OpenDialog.lpstrFile:=@S2;
    OpenDialog.nMaxFile:=255;
    OpenDialog.lpstrFileTitle:=NIL;
    OpenDialog.nMaxFileTitle:=0;
    OpenDialog.lpstrInitialDir:=NIL;
    OpenDialog.lpstrTitle:=PCHAR(S3);
    OpenDialog.Flags:=OFN_PATHMUSTEXIST OR OFN_FILEMUSTEXIST;
    IF GetOpenFileName(OpenDialog) THEN BEGIN
     MiniMODClass.LoadFile(OpenDialog.lpstrFile);
     S0:=MiniMODClass.Title;
     SETWINDOWTEXT(HEDIT[1],PCHAR(S0));
     MiniMODClass.Play;
    END;
   END;
  END;
  WM_DESTROY:IsDone:=TRUE;
 END;
END;

BEGIN
 MiniMODClass:=TMiniMOD.Create(44100,TRUE,TRUE);

 IsDone:=FALSE;

 HINST:=GETMODULEHANDLE(NIL);
 WITH WCLASS DO BEGIN
  STYLE:=CS_PARENTDC;
  HICON:=LOADICON(HINST,'MAINICON');
  LPFNWNDPROC:=@WINDOWPROC;
  HINSTANCE:=HINST;
  HBRBACKGROUND:=COLOR_BTNFACE+1;
  LPSZCLASSNAME:='MiniMOD';
  HCURSOR:=LOADCURSOR(0,IDC_ARROW);
 END;
 REGISTERCLASS(WCLASS);

 HANDLE:=CREATEWINDOW('MiniMOD','MiniMOD 1.00',WS_OVERLAPPED OR WS_CAPTION OR WS_SYSMENU OR WS_MINIMIZEBOX OR WS_VISIBLE,10,10,280,74,0,0,HINST,NIL);

 HLABEL[2]:=CREATEWINDOW('Static','Copyright (C) 2004, Benjamin Rosseaux',WS_VISIBLE OR WS_CHILD OR SS_LEFT,2,30,500,13,HANDLE,0,HINST,NIL);

 HEDIT[1]:=CREATEWINDOWEX(WS_EX_CLIENTEDGE,'Edit','',WS_VISIBLE OR WS_CHILD OR ES_LEFT OR ES_AUTOHSCROLL,2,4,190,21,HANDLE,0,HINST,NIL);

 HLABEL[1]:=CREATEWINDOW('Button','Open',WS_VISIBLE OR WS_CHILD,194,4,78,20,HANDLE,0,HINST,NIL);

 HFONT:=CREATEFONT(-12,0,0,0,0,0,0,0,DEFAULT_CHARSET,OUT_DEFAULT_PRECIS,CLIP_DEFAULT_PRECIS,DEFAULT_QUALITY,DEFAULT_PITCH OR FF_DONTCARE,'MS Sans Serif');
 HFONT2:=CREATEFONT(-12,0,0,0,0,0,0,0,DEFAULT_CHARSET,OUT_DEFAULT_PRECIS,CLIP_DEFAULT_PRECIS,DEFAULT_QUALITY,DEFAULT_PITCH OR FF_DONTCARE,'MS Sans Serif');

 SENDMESSAGE(HLABEL[1],WM_SETFONT,HFONT2,0);
 SENDMESSAGE(HLABEL[2],WM_SETFONT,HFONT,0);
 SENDMESSAGE(HEDIT[1],WM_SETFONT,HFONT,0);
 SENDMESSAGE(HEDIT[1],EM_SETREADONLY,HFONT,0);

 UPDATEWINDOW(HANDLE);

 SETTIMER(HANDLE,0,100,NIL);

 WHILE GetMessage(MSG,HANDLE,0,0) DO BEGIN
  IF IsDone THEN BREAK;
  TranslateMessage(MSG);
  DispatchMessage(MSG);
 END;

 DELETEOBJECT(HFONT);
 UNREGISTERCLASS('MiniMOD',HINST);
 MiniMODClass.Destroy;
END.


